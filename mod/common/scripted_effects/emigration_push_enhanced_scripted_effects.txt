# result is stored in a planet-scoped variable "pop_habitability_weighted_average"
# this = planet
calculate_planet_migration_percentage_from_habitability = {
	optimize_memory
	set_variable = {
		which = pop_habitability_weighted_average
		value = 0
	}
	every_owned_pop = {
		prev = {
			export_trigger_value_to_variable = {
				trigger = habitability
				parameters = { who = prev }
				variable = pop_species_habitability
			}
			set_variable = {
				which = pop_species_habitability_inverse
				value = 1
			}
			subtract_variable = {
				which = pop_species_habitability_inverse
				value = pop_species_habitability
			}
			change_variable = {
				which = pop_habitability_weighted_average
				value = pop_species_habitability_inverse
			}
			clear_variable = pop_species_habitability
			clear_variable = pop_species_habitability_inverse
		}
	}
	divide_variable = {
		which = pop_habitability_weighted_average
		value = trigger:num_pops
	}
}